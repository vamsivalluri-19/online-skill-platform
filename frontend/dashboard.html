<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Dashboard - VR Learning Online Learning Platform. Access your courses, track progress, and manage your learning journey.">
  <meta name="keywords" content="dashboard, courses, learning, progress, certificates, online education">
  <meta name="theme-color" content="#6366f1">
  <title>Dashboard - VR Learning | Your Learning Hub</title>

  <!-- External Stylesheets -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/auth-style.css">
  
  <!-- API Configuration (Load before main script) -->
  <script src="js/config.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary-color: #6366f1;
      --primary-dark: #4f46e5;
      --primary-light: #818cf8;
      --success-color: #10b981;
      --error-color: #ef4444;
      --warning-color: #f59e0b;
      --info-color: #3b82f6;
      --neutral-50: #f9fafb;
      --neutral-100: #f3f4f6;
      --neutral-200: #e5e7eb;
      --neutral-300: #d1d5db;
      --neutral-400: #9ca3af;
      --neutral-500: #6b7280;
      --neutral-600: #4b5563;
      --neutral-700: #2d3748;
      --neutral-800: #1f2937;
      --neutral-900: #0f172a;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --body-bg: var(--neutral-100);
      --card-bg: #ffffff;
      --text-main: #1e293b;
      --text-heading: #0f172a;
      --text-accent: #6366f1;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--body-bg);
      color: var(--text-main);
      overflow-x: hidden;
    }

    /* ENHANCED TEXT COLORS & STYLING */
    h1, h2, h3, h4, h5, h6 {
      color: var(--text-heading);
      font-weight: 700;
    }

    h1 { font-size: 32px; }
    h2 { font-size: 28px; background: linear-gradient(135deg, var(--text-heading) 0%, var(--text-accent) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    h3 { font-size: 20px; color: var(--text-heading); }

    .section-header h2 {
      background: linear-gradient(135deg, #0f172a 0%, #6366f1 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 800;
    }

    .section-header-subtitle {
      color: #64748b;
      font-weight: 500;
    }

    p {
      color: #334155;
      line-height: 1.6;
    }

    strong, .bold {
      color: var(--text-heading);
      font-weight: 700;
    }

    .course-title {
      color: var(--text-heading);
      font-weight: 700;
    }

    .course-description {
      color: #475569;
    }

    .course-instructor {
      color: #64748b;
    }    /* THEME BADGE / SELECTOR */

    .theme-selector {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      color: var(--neutral-600);
    }

    .theme-selector select {
      padding: 8px 12px;
      border-radius: 6px;
      border: 2px solid var(--neutral-200);
      font-size: 13px;
      background: var(--card-bg);
      color: var(--text-main);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .theme-selector select:hover {
      border-color: var(--primary-color);
      background: var(--neutral-100);
    }

    .theme-selector select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    /* HEADER */
    .header {
      background: var(--card-bg);
      box-shadow: var(--shadow-md);
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 2px solid var(--primary-color);
    }

    .header .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 70px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 24px;
      font-weight: 700;
      color: var(--primary-color);
      text-decoration: none;
    }

    .logo i {
      font-size: 28px;
    }

    .nav-center {
      display: flex;
      gap: 30px;
      flex: 1;
      justify-content: center;
    }

    .nav-center a {
      color: var(--text-main);
      text-decoration: none;
      font-weight: 500;
      transition: var(--transition);
      position: relative;
    }

    .nav-center a:hover {
      color: var(--primary-color);
    }

    .nav-center a::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--primary-color);
      transition: var(--transition);
    }

    .nav-center a:hover::after {
      width: 100%;
    }

    .nav-right {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    .search-box {
      position: relative;
      display: flex;
      align-items: center;
    }

    .search-box input {
      padding: 10px 15px;
      border: 2px solid var(--neutral-200);
      border-radius: 25px;
      width: 250px;
      font-size: 14px;
      transition: var(--transition);
      background: var(--card-bg);
      color: var(--text-main);
    }

    .search-box input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .search-box button {
      position: absolute;
      right: 10px;
      background: none;
      border: none;
      color: var(--neutral-500);
      cursor: pointer;
      font-size: 18px;
      transition: var(--transition);
    }

    .user-menu {
      display: flex;
      gap: 15px;
      align-items: center;
      position: relative;
    }

    .notification-icon {
      position: relative;
      font-size: 20px;
      cursor: pointer;
      color: var(--text-main);
      transition: var(--transition);
    }

    .notification-icon:hover {
      color: var(--primary-color);
    }

    .notification-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--error-color);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 5px 15px;
      border-radius: 25px;
      background: var(--neutral-100);
      cursor: pointer;
      transition: var(--transition);
    }

    .user-profile:hover {
      background: var(--neutral-200);
    }

    .user-avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 14px;
    }

    .user-profile-menu {
      position: absolute;
      top: 60px;
      right: 0;
      background: var(--card-bg);
      border-radius: 10px;
      box-shadow: var(--shadow-lg);
      padding: 10px 0;
      display: none;
      z-index: 200;
      min-width: 200px;
    }

    .user-profile-menu.active {
      display: block;
    }

    .user-profile-menu a,
    .user-profile-menu button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 12px 20px;
      border: none;
      background: none;
      color: var(--text-main);
      text-decoration: none;
      cursor: pointer;
      transition: var(--transition);
      font-size: 14px;
    }

    .user-profile-menu a:hover,
    .user-profile-menu button:hover {
      background: var(--neutral-100);
      color: var(--primary-color);
    }

    .user-profile-menu button.logout {
      color: var(--error-color);
      border-top: 1px solid var(--neutral-200);
    }

    /* SIDEBAR */

    .sidebar {
      position: fixed;
      left: 0;
      top: 70px;
      width: 280px;
      height: calc(100vh - 70px);
      background: var(--card-bg);
      border-right: 1px solid var(--neutral-200);
      padding: 20px 0;
      overflow-y: auto;
      z-index: 40;
    }

    .sidebar-section {
      margin-bottom: 20px;
    }

    .sidebar-title {
      font-size: 12px;
      font-weight: 700;
      color: var(--neutral-500);
      text-transform: uppercase;
      padding: 10px 20px;
      letter-spacing: 1px;
    }

    .sidebar-menu {
      list-style: none;
    }

    .sidebar-menu li {
      margin: 0;
    }

    .sidebar-menu a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 20px;
      color: var(--text-main);
      text-decoration: none;
      transition: var(--transition);
      border-left: 3px solid transparent;
      font-size: 14px;
      font-weight: 500;
    }

    .sidebar-menu a:hover {
      background: var(--neutral-50);
      color: var(--primary-color);
      border-left-color: var(--primary-color);
    }

    .sidebar-menu a.active {
      background: rgba(99, 102, 241, 0.1);
      color: var(--primary-color);
      border-left-color: var(--primary-color);
    }

    .sidebar-menu i {
      font-size: 18px;
      width: 20px;
      text-align: center;
    }

    /* MAIN CONTENT */

    .main-content {
      margin-left: 280px;
      margin-top: 70px;
      padding: 30px;
      min-height: calc(100vh - 70px);
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .page-section {
      display: none;
    }

    .page-section.active {
      display: block;
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .section-header h2 {
      font-size: 28px;
      color: var(--text-heading);
      font-weight: 700;
    }

    .section-header-subtitle {
      font-size: 13px;
      color: var(--neutral-500);
      margin-top: 4px;
    }

    .section-header-actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn-secondary {
      background: var(--neutral-100);
      color: var(--text-main);
      border: 2px solid var(--neutral-200);
    }

    .btn-secondary:hover {
      background: var(--neutral-50);
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    .btn-success {
      background: var(--success-color);
      color: white;
    }

    .btn-success:hover {
      background: #059669;
      transform: translateY(-1px);
    }

    /* DASHBOARD STATS */

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: var(--card-bg);
      padding: 24px;
      border-radius: 12px;
      box-shadow: var(--shadow-md);
      border-top: 4px solid var(--primary-color);
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .stat-card.green { border-top-color: var(--success-color); }
    .stat-card.blue { border-top-color: var(--info-color); }
    .stat-card.orange { border-top-color: var(--warning-color); }

    .stat-icon {
      font-size: 28px;
      margin-bottom: 12px;
    }

    .stat-card.green .stat-icon { color: var(--success-color); }
    .stat-card.blue .stat-icon { color: var(--info-color); }
    .stat-card.orange .stat-icon { color: var(--warning-color); }

    .stat-value {
      font-size: 30px;
      font-weight: 700;
      color: var(--text-heading);
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 14px;
      color: var(--neutral-500);
    }

    /* COURSES GRID */

    .courses-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 24px;
    }

    .course-card {
      background: var(--card-bg);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow-md);
      display: flex;
      flex-direction: column;
      transition: var(--transition);
      cursor: pointer;
    }

    .course-card:hover {
      transform: translateY(-6px);
      box-shadow: var(--shadow-lg);
    }

    .course-image {
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 42px;
      font-weight: 700;
      color: white;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    }

    .course-content {
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex: 1;
      background: var(--card-bg);
    }

    .course-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(99,102,241,0.08);
      color: var(--primary-color);
      font-size: 11px;
      font-weight: 600;
    }

    .course-level {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      margin-right: 6px;
    }

    .course-title {
      font-size: 17px;
      font-weight: 700;
      color: var(--text-heading);
    }

    .course-description {
      font-size: 13px;
      color: var(--neutral-500);
      line-height: 1.5;
      flex: 1;
    }

    .course-instructor {
      font-size: 13px;
      color: var(--neutral-600);
    }

    .progress-bar {
      height: 6px;
      background: var(--neutral-200);
      border-radius: 999px;
      overflow: hidden;
      margin-bottom: 4px;
    }

    .progress-fill {
      height: 100%;
      background: var(--success-color);
      width: 0;
      transition: width 0.3s ease;
    }

    .course-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-top: 1px solid var(--neutral-200);
      padding-top: 10px;
      margin-top: 8px;
      font-size: 12px;
    }

    .course-rating {
      display: flex;
      align-items: center;
      gap: 4px;
      color: var(--warning-color);
    }

    .course-students {
      color: var(--neutral-500);
    }

    /* VIDEO / YOUTUBE EMBED */

    .video-wrapper {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      border-radius: 12px;
      box-shadow: var(--shadow-md);
      background: #000;
      margin-bottom: 10px;
    }

    .video-wrapper iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 0;
    }

    .video-meta {
      font-size: 13px;
      color: var(--neutral-500);
      margin-bottom: 4px;
    }

    .video-meta a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 600;
    }

    /* TABLES */

    .table-container {
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: var(--shadow-md);
      overflow: hidden;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      background: var(--neutral-50);
      border-bottom: 1px solid var(--neutral-200);
    }

    th, td {
      padding: 14px 16px;
      font-size: 13px;
      text-align: left;
      color: var(--text-main);
    }

    th {
      font-weight: 600;
      color: var(--neutral-600);
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    tbody tr:nth-child(even) {
      background: var(--neutral-50);
    }

    tbody tr:hover {
      background: rgba(99,102,241,0.04);
    }

    /* PROFILE */

    .profile-header {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 24px;
      display: flex;
      gap: 24px;
      align-items: center;
      box-shadow: var(--shadow-md);
      margin-bottom: 24px;
    }

    .profile-avatar-large {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 40px;
      font-weight: 700;
    }

    .profile-stats {
      display: flex;
      gap: 24px;
      margin: 12px 0;
    }

    .profile-stat-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary-color);
    }

    .profile-stat-label {
      font-size: 12px;
      color: var(--neutral-500);
    }

    /* ALERTS */

    .alert {
      padding: 12px 14px;
      border-radius: 8px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-left: 4px solid;
      font-size: 13px;
    }

    .alert-success {
      background: #ecfdf5;
      color: #065f46;
      border-color: #10b981;
    }

    .alert-error {
      background: #fef2f2;
      color: #7f1d1d;
      border-color: #ef4444;
    }

    .alert-info {
      background: #eff6ff;
      color: #0c4a6e;
      border-color: #3b82f6;
    }

    .alert-warning {
      background: #fffbeb;
      color: #92400e;
      border-color: #f59e0b;
    }

    .alert-close {
      margin-left: auto;
      background: none;
      border: none;
      color: inherit;
      cursor: pointer;
    }

    /* SIMPLE TAG / BADGE LISTS */

    .pill-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--neutral-200);
      font-size: 11px;
      color: var(--neutral-600);
      background: var(--neutral-50);
    }

    /* COURSE MODAL */

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 500;
    }

    .modal-backdrop.active {
      display: flex;
    }

    .modal {
      background: var(--card-bg);
      border-radius: 16px;
      max-width: 900px;
      width: 100%;
      padding: 20px;
      box-shadow: var(--shadow-xl);
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .modal-header h3 {
      font-size: 20px;
      color: var(--text-heading);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: var(--neutral-500);
    }

    .modal-body {
      font-size: 14px;
      color: var(--text-main);
    }

    .modal-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin: 10px 0 16px 0;
      font-size: 12px;
      color: var(--neutral-500);
    }

    .modal-meta span i {
      margin-right: 4px;
    }

    /* RESPONSIVE */

    @media (max-width: 1024px) {
      .sidebar {
        width: 240px;
      }
      .main-content {
        margin-left: 240px;
      }
    }

    @media (max-width: 768px) {
      .header .container {
        flex-wrap: wrap;
        gap: 10px;
        height: auto;
        padding: 10px 16px;
      }
      .nav-center {
        display: none;
      }
      .search-box {
        display: none;
      }
      .sidebar {
        left: -260px;
        transition: left 0.3s ease;
        top: 0;
        height: 100vh;
      }
      .sidebar.active {
        left: 0;
      }
      .main-content {
        margin-left: 0;
        padding: 20px;
      }
      .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
    }

    @media (max-width: 480px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      .courses-grid {
        grid-template-columns: 1fr;
      }
      .profile-header {
        flex-direction: column;
        text-align: center;
      }
      .profile-stats {
        justify-content: center;
      }
    }
  </style>
</head>
<body>

<header class="header">
  <div class="container">
    <a href="index.html" class="logo">
      <i class="fas fa-graduation-cap"></i>
      <span>VR LEARNING</span>
    </a>

    <nav class="nav-center">
      <a href="#dashboard" onclick="navigateTo('dashboard')">Dashboard</a>
      <a href="#courses" onclick="navigateTo('courses')">My Courses</a>
      <a href="#wishlist" onclick="navigateTo('wishlist')">Wishlist</a>
      <a href="#certificates" onclick="navigateTo('certificates')">Certificates</a>
      <a href="#downloads" onclick="navigateTo('downloads')">Downloads</a>
    </nav>

    <div class="nav-right">
      <div class="theme-selector">
        <span>Theme</span>
        <select id="themeSelect" onchange="changeTheme(this.value)">
          <option value="light">Light</option>
          <option value="dark">Dark</option>
          <option value="high-contrast">High contrast</option>
        </select>
      </div>

      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search courses...">
        <button onclick="searchCourses()"><i class="fas fa-search"></i></button>
      </div>

      <div class="notification-icon" onclick="toggleNotifications()">
        <i class="fas fa-bell"></i>
        <span class="notification-badge" id="notificationBadge">5</span>
      </div>

      <div class="user-menu" onclick="toggleUserMenu(event)">
        <div class="user-profile">
          <div class="user-avatar" id="userInitials">JD</div>
          <span id="userName" style="font-weight: 500; color: var(--text-main);">John Doe</span>
        </div>
        <div class="user-profile-menu" id="userProfileMenu">
          <a href="#profile" onclick="navigateTo('profile')"><i class="fas fa-user"></i> My Profile</a>
          <a href="#settings" onclick="navigateTo('settings')"><i class="fas fa-cog"></i> Settings</a>
          <a href="#help" onclick="navigateTo('help')"><i class="fas fa-question-circle"></i> Help & Support</a>
          <button class="logout" onclick="logoutUser()"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Sidebar -->
<aside class="sidebar" id="sidebar">
  <div class="sidebar-section">
    <div class="sidebar-title">Main</div>
    <ul class="sidebar-menu">
      <li><a href="#dashboard" data-page="dashboard" onclick="navigateTo('dashboard')" class="active"><i class="fas fa-home"></i> Dashboard</a></li>
      <li><a href="#courses" data-page="courses" onclick="navigateTo('courses')"><i class="fas fa-book"></i> My Courses</a></li>
      <li><a href="#wishlist" data-page="wishlist" onclick="navigateTo('wishlist')"><i class="fas fa-heart"></i> Wishlist</a></li>
    </ul>
  </div>

  <div class="sidebar-section">
    <div class="sidebar-title">Learning</div>
    <ul class="sidebar-menu">
      <li><a href="#certificates" data-page="certificates" onclick="navigateTo('certificates')"><i class="fas fa-certificate"></i> Certificates</a></li>
      <li><a href="#downloads" data-page="downloads" onclick="navigateTo('downloads')"><i class="fas fa-download"></i> Downloads</a></li>
      <li><a href="#progress" data-page="progress" onclick="navigateTo('progress')"><i class="fas fa-chart-line"></i> Progress</a></li>
    </ul>
  </div>

  <div class="sidebar-section">
    <div class="sidebar-title">Account</div>
    <ul class="sidebar-menu">
      <li><a href="#profile" data-page="profile" onclick="navigateTo('profile')"><i class="fas fa-user-circle"></i> Profile</a></li>
      <li><a href="#settings" data-page="settings" onclick="navigateTo('settings')"><i class="fas fa-sliders-h"></i> Settings</a></li>
      <li><a href="#notifications" data-page="notifications" onclick="navigateTo('notifications')"><i class="fas fa-bell"></i> Notifications</a></li>
    </ul>
  </div>

  <div class="sidebar-section">
    <div class="sidebar-title">Support</div>
    <ul class="sidebar-menu">
      <li><a href="#help" data-page="help" onclick="navigateTo('help')"><i class="fas fa-question-circle"></i> Help Center</a></li>
      <li><a href="#contact" data-page="contact" onclick="navigateTo('contact')"><i class="fas fa-envelope"></i> Contact Us</a></li>
      <li><a href="#themes" data-page="themes" onclick="navigateTo('themes')"><i class="fas fa-palette"></i> Themes</a></li>
    </ul>
  </div>
</aside>

<main class="main-content">
  <div class="container">

    <!-- Dashboard -->
    <section id="dashboard-page" class="page-section active" data-page="dashboard">
      <div class="section-header">
        <div>
          <h2>Welcome, <span id="greetingName">John</span>! ðŸ‘‹</h2>
          <p class="section-header-subtitle">Here is your learning summary for this week along with quick access to your active courses and previews.</p>
        </div>
        <div class="section-header-actions">
          <button class="btn btn-primary" onclick="navigateTo('courses')"><i class="fas fa-compass"></i> Explore Courses</button>
          <button class="btn btn-secondary" onclick="navigateTo('progress')"><i class="fas fa-chart-bar"></i> View Progress</button>
        </div>
      </div>

      <div class="dashboard-grid">
        <div class="stat-card green">
          <div class="stat-icon"><i class="fas fa-book-open"></i></div>
          <div class="stat-value" id="enrolledCount">10</div>
          <div class="stat-label">Courses Enrolled</div>
          <p style="font-size:12px;margin-top:6px;color:var(--neutral-500);">Keep building your streak by completing at least one lesson per day.</p>
        </div>
        <div class="stat-card blue">
          <div class="stat-icon"><i class="fas fa-clock"></i></div>
          <div class="stat-value" id="hoursLearned">125</div>
          <div class="stat-label">Hours Learned</div>
          <p style="font-size:12px;margin-top:6px;color:var(--neutral-500);">Aim for a minimum of 7 learning hours every week to maintain consistency.</p>
        </div>
        <div class="stat-card orange">
          <div class="stat-icon"><i class="fas fa-certificate"></i></div>
          <div class="stat-value" id="certCount">6</div>
          <div class="stat-label">Certificates Earned</div>
          <p style="font-size:12px;margin-top:6px;color:var(--neutral-500);">Showcase your certificates on LinkedIn and your resume.</p>
        </div>
        <div class="stat-card" style="border-top-color:#8b5cf6;">
          <div class="stat-icon" style="color:#8b5cf6;"><i class="fas fa-star"></i></div>
          <div class="stat-value" id="avgRating">4.7</div>
          <div class="stat-label">Average Rating</div>
          <p style="font-size:12px;margin-top:6px;color:var(--neutral-500);">Highly rated courses indicate you are learning from top-quality content.</p>
        </div>
      </div>

      <!-- Course Preview Videos -->
      <div style="margin-bottom:32px;">
        <div class="section-header">
          <div>
            <h2>Course Preview Videos</h2>
            <p class="section-header-subtitle">Watch short YouTube previews of your top courses directly on the dashboard.</p>
          </div>
          <a href="#courses" onclick="navigateTo('courses')" style="font-size:13px; color:var(--primary-color); text-decoration:none; font-weight:600;">Go to My Courses â†’</a>
        </div>

        <div class="courses-grid" id="previewVideosGrid">
          <!-- Filled dynamically -->
        </div>
      </div>

      <div style="margin-bottom:32px;">
        <div class="section-header">
          <div>
            <h2>Continuing Education</h2>
            <p class="section-header-subtitle">Resume exactly where you left off in your most active courses.</p>
          </div>
          <a href="#courses" onclick="navigateTo('courses')" style="font-size:13px; color:var(--primary-color); text-decoration:none; font-weight:600;">View All â†’</a>
        </div>
        <div class="courses-grid" id="activeCourses"></div>
      </div>

      <div style="margin-bottom:32px;">
        <div class="section-header">
          <div>
            <h2>Recent Activity</h2>
            <p class="section-header-subtitle">Track your latest lessons, quizzes, and assignments across all courses.</p>
          </div>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Course</th>
                <th>Activity</th>
                <th>Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="activityTable"></tbody>
          </table>
        </div>
      </div>

      <div>
        <div class="section-header">
          <div>
            <h2>Recommended For You</h2>
            <p class="section-header-subtitle">Curated suggestions based on your interests in programming, design, and data.</p>
          </div>
        </div>
        <div class="courses-grid" id="recommendedCourses"></div>
      </div>
    </section>

    <!-- My Courses -->
    <section id="courses-page" class="page-section" data-page="courses">
      <div class="section-header">
        <div>
          <h2>My Courses</h2>
          <p class="section-header-subtitle">Manage all enrolled courses, filter by category or difficulty, and open video previews.</p>
        </div>
        <div class="section-header-actions">
          <button class="btn btn-secondary" onclick="toggleFilters()"><i class="fas fa-filter"></i> Filters</button>
        </div>
      </div>

      <div id="filterSection" style="display:none; background:var(--card-bg); border-radius:12px; padding:16px; box-shadow:var(--shadow-md); margin-bottom:20px;">
        <p style="font-size:13px;color:var(--neutral-600);margin-bottom:10px;">Use filters below to quickly find courses that match your current goals.</p>
        <div style="display:grid; grid-template-columns: repeat(auto-fit,minmax(180px,1fr)); gap:12px;">
          <div>
            <label style="font-size:12px; font-weight:600; color:var(--neutral-600); margin-bottom:4px; display:block;">Category</label>
            <select id="categoryFilter" onchange="applyFilters()" style="width:100%; padding:8px; border-radius:8px; border:2px solid var(--neutral-200);">
              <option value="">All</option>
              <option value="programming">Programming</option>
              <option value="design">Design</option>
              <option value="data">Data Science</option>
              <option value="business">Business</option>
              <option value="marketing">Marketing</option>
            </select>
          </div>
          <div>
            <label style="font-size:12px; font-weight:600; color:var(--neutral-600); margin-bottom:4px; display:block;">Level</label>
            <select id="levelFilter" onchange="applyFilters()" style="width:100%; padding:8px; border-radius:8px; border:2px solid var(--neutral-200);">
              <option value="">All</option>
              <option value="beginner">Beginner</option>
              <option value="intermediate">Intermediate</option>
              <option value="advanced">Advanced</option>
            </select>
          </div>
          <div>
            <label style="font-size:12px; font-weight:600; color:var(--neutral-600); margin-bottom:4px; display:block;">Progress</label>
            <select id="progressFilter" onchange="applyFilters()" style="width:100%; padding:8px; border-radius:8px; border:2px solid var(--neutral-200);">
              <option value="">All</option>
              <option value="0-25">0-25%</option>
              <option value="25-50">25-50%</option>
              <option value="50-75">50-75%</option>
              <option value="75-100">75-100%</option>
            </select>
          </div>
        </div>
      </div>

      <div class="courses-grid" id="myCoursesGrid"></div>
    </section>

    <!-- Wishlist -->
    <section id="wishlist-page" class="page-section" data-page="wishlist">
      <div class="section-header">
        <div>
          <h2>Wishlist</h2>
          <p class="section-header-subtitle">Save interesting courses to enroll later and preview their intro videos.</p>
        </div>
        <button class="btn btn-secondary"><i class="fas fa-download"></i> Export Wishlist</button>
      </div>
      <p style="font-size:13px;color:var(--neutral-600);margin-bottom:12px;">Courses in your wishlist do not expire. Revisit them when you are ready to learn something new.</p>
      <div class="courses-grid" id="wishlistGrid"></div>
    </section>

    <!-- Certificates -->
    <section id="certificates-page" class="page-section" data-page="certificates">
      <div class="section-header">
        <div>
          <h2>Your Certificates</h2>
          <p class="section-header-subtitle">Upload your certificates and manage view/download access.</p>
        </div>
      </div>
      <p style="font-size:13px;color:var(--neutral-600);margin-bottom:12px;">Add your own certificates below and keep them in one place.</p>

      <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:16px; margin-bottom:20px;">
        <div style="background:var(--card-bg); border-radius:12px; padding:16px; box-shadow:var(--shadow-md);">
          <h3 style="font-size:16px; margin-bottom:8px;">Upload Certificate</h3>
          <p style="font-size:13px;color:var(--neutral-600);margin-bottom:10px;">Add your own certificate files (PDF/JPG/PNG). They will appear below for view/download.</p>
          <div style="display:grid; gap:10px;">
            <input type="text" id="customCertTitle" placeholder="Certificate title" style="padding:8px; border-radius:8px; border:2px solid var(--neutral-200);">
            <input type="text" id="customCertIssuer" placeholder="Issuer (e.g., Coursera)" style="padding:8px; border-radius:8px; border:2px solid var(--neutral-200);">
            <input type="date" id="customCertDate" style="padding:8px; border-radius:8px; border:2px solid var(--neutral-200);">
            <input type="file" id="customCertFile" accept=".pdf,.png,.jpg,.jpeg" style="padding:8px; border-radius:8px; border:2px solid var(--neutral-200);">
            <button class="btn btn-primary" onclick="uploadCustomCertificate()"><i class="fas fa-upload"></i> Upload Certificate</button>
          </div>
        </div>

        <div style="background:var(--card-bg); border-radius:12px; padding:16px; box-shadow:var(--shadow-md);">
          <h3 style="font-size:16px; margin-bottom:8px;">Resume</h3>
          <p style="font-size:13px;color:var(--neutral-600);margin-bottom:10px;">Upload your resume (PDF/DOC/DOCX) and keep it ready for download.</p>
          <div style="display:grid; gap:10px;">
            <input type="file" id="resumeFile" accept=".pdf,.doc,.docx" style="padding:8px; border-radius:8px; border:2px solid var(--neutral-200);">
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
              <button class="btn btn-primary" onclick="uploadResume()"><i class="fas fa-upload"></i> Upload Resume</button>
              <button class="btn btn-secondary" onclick="viewResume()"><i class="fas fa-eye"></i> View</button>
              <button class="btn btn-secondary" onclick="downloadResume()"><i class="fas fa-download"></i> Download</button>
            </div>
            <div id="resumeStatus" style="font-size:12px;color:var(--neutral-500);">No resume uploaded yet.</div>
          </div>
        </div>
      </div>

      <h3 style="font-size:16px; margin-bottom:10px;">Your Uploaded Certificates</h3>
      <div class="courses-grid" id="userCertificatesList"></div>

    </section>

    <!-- Downloads -->
    <section id="downloads-page" class="page-section" data-page="downloads">
      <div class="section-header">
        <div>
          <h2>Downloads</h2>
          <p class="section-header-subtitle">Find all PDFs, slides, and project files you have downloaded from your courses.</p>
        </div>
      </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Resource</th>
              <th>Course</th>
              <th>Type</th>
              <th>Date</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="downloadsTable"></tbody>
        </table>
      </div>

      <div style="margin-top:40px;">
        <div class="section-header">
          <div>
            <h2>Recommended For You</h2>
            <p class="section-header-subtitle">Explore these curated courses based on your interests and learning history.</p>
          </div>
        </div>
        <div class="courses-grid" id="downloadRecommendedCourses"></div>
      </div>
    </section>

    <!-- Progress -->
    <section id="progress-page" class="page-section" data-page="progress">
      <div class="section-header">
        <div>
          <h2>Progress</h2>
          <p class="section-header-subtitle">Visualize your weekly learning hours and completion status across courses.</p>
        </div>
      </div>

      <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:20px; margin-bottom:20px;">
        <div style="background:var(--card-bg); border-radius:12px; padding:16px; box-shadow:var(--shadow-md);">
          <h3 style="font-size:16px; margin-bottom:12px;">Weekly Learning Hours</h3>
          <p style="font-size:13px;color:var(--neutral-600);margin-bottom:10px;">Each bar represents the total hours you studied per day during the last week.</p>
          <div id="weeklyProgress"></div>
        </div>
        <div style="background:var(--card-bg); border-radius:12px; padding:16px; box-shadow:var(--shadow-md);">
          <h3 style="font-size:16px; margin-bottom:12px;">Course Completion</h3>
          <p style="font-size:13px;color:var(--neutral-600);margin-bottom:10px;">Monitor how close you are to finishing your most important courses.</p>
          <div id="courseCompletion"></div>
        </div>
      </div>

      <div style="background:var(--card-bg); border-radius:12px; padding:16px; box-shadow:var(--shadow-md);">
        <h3 style="font-size:16px; margin-bottom:12px;">Detailed Progress</h3>
        <p style="font-size:13px;color:var(--neutral-600);margin-bottom:10px;">See lessons completed, total duration, and rating for each enrolled course.</p>
        <div id="progressDetails"></div>
      </div>
    </section>

    <!-- Profile -->
    <section id="profile-page" class="page-section" data-page="profile">
      <div class="section-header">
        <div>
          <h2>My Profile</h2>
          <p class="section-header-subtitle">Review your learning identity and update key information from Settings.</p>
        </div>
        <button class="btn btn-primary" onclick="navigateTo('settings')"><i class="fas fa-edit"></i> Edit Profile</button>
      </div>

      <div class="profile-header">
        <div class="profile-avatar-large" id="profileAvatarLarge">JD</div>
        <div>
          <h3 id="profileName">John Doe</h3>
          <p id="profileRole" style="font-size:14px; color:var(--neutral-500);">Student</p>
          <div class="profile-stats">
            <div>
              <div class="profile-stat-value" id="profileCoursesCount">10</div>
              <div class="profile-stat-label">Courses</div>
            </div>
            <div>
              <div class="profile-stat-value" id="profileHoursCount">125</div>
              <div class="profile-stat-label">Hours</div>
            </div>
            <div>
              <div class="profile-stat-value" id="profileCertCount">6</div>
              <div class="profile-stat-label">Certificates</div>
            </div>
          </div>
          <p id="profileEmail" style="font-size:13px; color:var(--neutral-600);">john@example.com</p>
          <div class="pill-list">
            <span class="pill"><i class="fas fa-code"></i> JavaScript</span>
            <span class="pill"><i class="fas fa-database"></i> Backend</span>
            <span class="pill"><i class="fas fa-mobile-alt"></i> Responsive Design</span>
          </div>
        </div>
      </div>

      <div style="background:var(--card-bg); border-radius:12px; padding:16px; box-shadow:var(--shadow-md); margin-bottom:20px;">
        <h3 style="font-size:16px; margin-bottom:10px;">About</h3>
        <p id="profileBio" style="font-size:14px; color:var(--neutral-600);">Passionate learner focused on full-stack web development and modern JavaScript frameworks. Loves building real-world projects and participating in coding challenges.</p>
        <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:12px; margin-top:12px;">
          <div>
            <div style="font-size:11px; text-transform:uppercase; color:var(--neutral-500); font-weight:600;">Location</div>
            <div id="profileLocation" style="font-size:14px;">India</div>
          </div>
          <div>
            <div style="font-size:11px; text-transform:uppercase; color:var(--neutral-500); font-weight:600;">Member Since</div>
            <div id="profileMemberSince" style="font-size:14px;">January 2024</div>
          </div>
          <div>
            <div style="font-size:11px; text-transform:uppercase; color:var(--neutral-500); font-weight:600;">Specialization</div>
            <div id="profileSpecialization" style="font-size:14px;">Full-Stack Web Development</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Settings -->
    <section id="settings-page" class="page-section" data-page="settings">
      <div class="section-header">
        <div>
          <h2>Settings</h2>
          <p class="section-header-subtitle">Control your account information, notifications, and safety preferences.</p>
        </div>
      </div>

      <div style="background:var(--card-bg); border-radius:12px; padding:16px; box-shadow:var(--shadow-md); margin-bottom:16px;">
        <h3 style="font-size:16px; margin-bottom:10px;">Account</h3>
        <p style="font-size:13px;color:var(--neutral-600);margin-bottom:10px;">Update your email address and manage security options.</p>
        <div style="margin-bottom:10px;">
          <label style="font-size:12px; font-weight:600; color:var(--neutral-600); display:block; margin-bottom:4px;">Email</label>
          <input type="email" id="settingsEmail" style="padding:8px; border-radius:8px; border:2px solid var(--neutral-200); width:100%;" value="john@example.com">
        </div>
        <button class="btn btn-secondary"><i class="fas fa-lock"></i> Change Password</button>
      </div>

      <div style="background:var(--card-bg); border-radius:12px; padding:16px; box-shadow:var(--shadow-md); margin-bottom:16px;">
        <h3 style="font-size:16px; margin-bottom:10px;">Notifications</h3>
        <p style="font-size:13px;color:var(--neutral-600);margin-bottom:10px;">Choose when VRLEARN should send you updates.</p>
        <label style="display:flex; align-items:center; gap:8px; font-size:14px; margin-bottom:6px;">
          <input type="checkbox" checked style="width:18px; height:18px;"> Email me about new courses
        </label>
        <label style="display:flex; align-items:center; gap:8px; font-size:14px; margin-bottom:6px;">
          <input type="checkbox" checked style="width:18px; height:18px;"> Weekly progress summary
        </label>
        <label style="display:flex; align-items:center; gap:8px; font-size:14px;">
          <input type="checkbox" style="width:18px; height:18px;"> Course recommendations
        </label>
      </div>

      <div style="background:var(--card-bg); border-radius:12px; padding:16px; box-shadow:var(--shadow-md);">
        <h3 style="font-size:16px; margin-bottom:10px; color:var(--error-color);">Danger Zone</h3>
        <p style="font-size:13px; color:var(--neutral-600); margin-bottom:10px;">Deleting your account is irreversible and will remove all your data including progress and certificates.</p>
        <button class="btn" style="background:var(--error-color); color:white;" onclick="deleteAccount()"><i class="fas fa-trash"></i> Delete Account</button>
      </div>
    </section>

    <!-- Notifications -->
    <section id="notifications-page" class="page-section" data-page="notifications">
      <div class="section-header">
        <div>
          <h2>Notifications</h2>
          <p class="section-header-subtitle">View updates about courses, messages, and achievements in one place.</p>
        </div>
        <button class="btn btn-secondary" onclick="markAllAsRead()"><i class="fas fa-check-double"></i> Mark all as read</button>
      </div>

      <div style="display:flex; gap:8px; margin-bottom:12px;">
        <button class="btn btn-secondary active" id="filterAll" onclick="filterNotifications('all')">All</button>
        <button class="btn btn-secondary" id="filterCourses" onclick="filterNotifications('courses')">Courses</button>
        <button class="btn btn-secondary" id="filterMessages" onclick="filterNotifications('messages')">Messages</button>
        <button class="btn btn-secondary" id="filterAchievements" onclick="filterNotifications('achievements')">Achievements</button>
      </div>

      <div id="notificationsContainer"></div>
    </section>

    <!-- Help -->
    <section id="help-page" class="page-section" data-page="help">
      <div class="section-header">
        <div>
          <h2>Help Center</h2>
          <p class="section-header-subtitle">Find quick answers or contact support for more complex questions.</p>
        </div>
      </div>

      <div style="background:var(--card-bg); border-radius:12px; padding:16px; box-shadow:var(--shadow-md); margin-bottom:16px;">
        <h3 style="font-size:16px; margin-bottom:10px;">Frequently Asked Questions</h3>
        <p style="font-size:13px;color:var(--neutral-600);margin-bottom:10px;">Tap on a question below to expand the answer.</p>
        <div id="faqContainer" style="display:grid; gap:10px;"></div>
      </div>

      <div style="background:var(--card-bg); border-radius:12px; padding:16px; box-shadow:var(--shadow-md);">
        <h3 style="font-size:16px; margin-bottom:10px;">Contact Support</h3>
        <p style="font-size:14px; color:var(--neutral-600); margin-bottom:12px;">You can reach us anytime using the following channels:</p>
        <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:12px;">
          <div style="background:var(--neutral-50); border-radius:8px; padding:12px; border-left:4px solid var(--primary-color);">
            <div style="font-weight:600; margin-bottom:4px;"><i class="fas fa-envelope"></i> Email</div>
            <div style="font-size:14px; color:var(--neutral-600);">support@vrlearn.com</div>
          </div>
          <div style="background:var(--neutral-50); border-radius:8px; padding:12px; border-left:4px solid var(--primary-color);">
            <div style="font-weight:600; margin-bottom:4px;"><i class="fas fa-phone"></i> Phone</div>
            <div style="font-size:14px; color:var(--neutral-600);">+1 (555) 123-4567</div>
          </div>
          <div style="background:var(--neutral-50); border-radius:8px; padding:12px; border-left:4px solid var(--primary-color);">
            <div style="font-weight:600; margin-bottom:4px;"><i class="fas fa-comments"></i> Live Chat</div>
            <div style="font-size:14px; color:var(--neutral-600);">Available 24/7</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Contact -->
    <section id="contact-page" class="page-section" data-page="contact">
      <div class="section-header">
        <div>
          <h2>Contact Us</h2>
          <p class="section-header-subtitle">Share feedback, report a bug, or ask anything about your learning journey.</p>
        </div>
      </div>

      <div style="max-width:540px;">
        <div style="background:var(--card-bg); border-radius:12px; padding:16px; box-shadow:var(--shadow-md);">
          <form onsubmit="submitContact(event)">
            <div style="margin-bottom:10px;">
              <label style="font-size:12px; font-weight:600; color:var(--neutral-600); display:block; margin-bottom:4px;">Subject</label>
              <input type="text" required placeholder="How can we help?" style="width:100%; padding:8px; border-radius:8px; border:2px solid var(--neutral-200);">
            </div>
            <div style="margin-bottom:10px;">
              <label style="font-size:12px; font-weight:600; color:var(--neutral-600); display:block; margin-bottom:4px;">Category</label>
              <select required style="width:100%; padding:8px; border-radius:8px; border:2px solid var(--neutral-200);">
                <option value="">Select a category</option>
                <option value="technical">Technical Support</option>
                <option value="billing">Billing Issue</option>
                <option value="course">Course Question</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div style="margin-bottom:10px;">
              <label style="font-size:12px; font-weight:600; color:var(--neutral-600); display:block; margin-bottom:4px;">Message</label>
              <textarea required placeholder="Describe your issue..." style="width:100%; padding:8px; border-radius:8px; border:2px solid var(--neutral-200); min-height:120px;"></textarea>
            </div>
            <button type="submit" class="btn btn-primary" style="width:100%;"><i class="fas fa-paper-plane"></i> Send Message</button>
          </form>
        </div>
      </div>
    </section>

    <!-- Themes -->
    <section id="themes-page" class="page-section" data-page="themes">
      <div class="section-header">
        <div>
          <h2>Theme & Appearance</h2>
          <p class="section-header-subtitle">Switch between light, dark, and high-contrast modes for a comfortable learning experience.</p>
        </div>
      </div>

      <div style="background:var(--card-bg); border-radius:12px; padding:16px; box-shadow:var(--shadow-md); margin-bottom:16px;">
        <h3 style="font-size:16px; margin-bottom:10px;">Theme Modes</h3>
        <p style="font-size:13px;color:var(--neutral-600);margin-bottom:10px;">Use the quick selector in the header or choose a mode below to apply instantly.</p>
        <div style="display:flex; flex-wrap:wrap; gap:12px;">
          <button class="btn btn-secondary" onclick="changeTheme('light')"><i class="fas fa-sun"></i> Light</button>
          <button class="btn btn-secondary" onclick="changeTheme('dark')"><i class="fas fa-moon"></i> Dark</button>
          <button class="btn btn-secondary" onclick="changeTheme('high-contrast')"><i class="fas fa-adjust"></i> High Contrast</button>
        </div>
      </div>

      <div style="background:var(--card-bg); border-radius:12px; padding:16px; box-shadow:var(--shadow-md);">
        <h3 style="font-size:16px; margin-bottom:10px;">Tips for Comfortable Study</h3>
        <ul style="font-size:13px;color:var(--neutral-600);margin-left:18px;line-height:1.6;">
          <li>Use dark mode in low-light environments to reduce eye strain.</li>
          <li>Use high-contrast mode if you prefer stronger separation between elements.</li>
          <li>Adjust your screen brightness and font size in your browser for longer sessions.</li>
        </ul>
      </div>
    </section>

  </div>
</main>

<!-- Course Modal -->
<div class="modal-backdrop" id="courseModalBackdrop">
  <div class="modal">
    <div class="modal-header">
      <h3 id="modalCourseTitle">Course title</h3>
      <button class="modal-close" onclick="closeCourseModal()"><i class="fas fa-times"></i></button>
    </div>
    <div class="modal-body">
      <div class="video-wrapper" id="modalVideoWrapper">
        <!-- iframe injected dynamically -->
      </div>
      <div class="video-meta">
        Watch this full preview on
        <a href="#" target="_blank" id="modalYoutubeLink">YouTube</a>.
      </div>
      <p id="modalCourseDescription" style="margin-bottom:10px;"></p>
      <div class="modal-meta" id="modalMeta"></div>
      <h4 style="font-size:14px;margin:10px 0 6px 0;">What you will learn</h4>
      <ul id="modalLearnList" style="font-size:13px;color:var(--neutral-600);margin-left:18px;line-height:1.6;"></ul>
    </div>
  </div>
</div>

<script>
const CONFIG = {
  API_BASE_URL: window.API_BASE_URL || 'http://localhost:5000', // Use config.js or fallback
  REDIRECT_DELAY: 1500
};

const COURSES_DATA = [
  { id:1, title:"The Complete JavaScript Course 2024", instructor:"Jonas Schmedtmann", category:"programming", level:"beginner", progress:78, image:"JS", rating:4.8, students:1200000, price:14.99, description:"Master JavaScript from basics to advanced ES6+, async/await, and more.", modules:27, lessons:312, duration:44, youtubeId:"PkZNo7MFNFg", youtubeUrl:"https://www.youtube.com/watch?v=PkZNo7MFNFg", learn:["Understand JS fundamentals and syntax","Work confidently with DOM and events","Use modern ES6+ features in real projects"] },
  { id:2, title:"React - The Complete Guide 2024", instructor:"Maximilian SchwarzmÃ¼ller", category:"programming", level:"intermediate", progress:65, image:"RE", rating:4.9, students:850000, price:14.99, description:"Learn React with hooks, context, Redux, routing, and real-world projects.", modules:36, lessons:470, duration:48, youtubeId:"w7ejDZ8SWv8", youtubeUrl:"https://www.youtube.com/watch?v=w7ejDZ8SWv8", learn:["Build SPA with React Router","Manage state with hooks and context","Optimize apps for performance"] },
  { id:3, title:"The Ultimate Python Learning Path", instructor:"Colt Steele", category:"programming", level:"beginner", progress:45, image:"PY", rating:4.7, students:950000, price:13.99, description:"Complete Python course covering core syntax, OOP, data structures.", modules:18, lessons:250, duration:35, youtubeId:"rfscVS0vtbw", youtubeUrl:"https://www.youtube.com/watch?v=rfscVS0vtbw", learn:["Write clean Python scripts","Work with lists, tuples, and dictionaries","Understand classes and OOP patterns"] },
  { id:4, title:"Web Design for Beginners", instructor:"Susan Ferreira", category:"design", level:"beginner", progress:92, image:"WD", rating:4.6, students:450000, price:12.99, description:"Learn web design, UI/UX, color theory, and responsive layouts.", modules:15, lessons:180, duration:24, youtubeId:"3JluqTojuME", youtubeUrl:"https://www.youtube.com/watch?v=3JluqTojuME", learn:["Design aesthetic landing pages","Use color and typography effectively","Create responsive layouts"] },
  { id:5, title:"Data Science Bootcamp", instructor:"Andrew Ng", category:"data", level:"advanced", progress:55, image:"DS", rating:4.9, students:780000, price:19.99, description:"Master data science with Python, ML, and real projects.", modules:45, lessons:600, duration:60, youtubeId:"ua-CiDNNj30", youtubeUrl:"https://www.youtube.com/watch?v=ua-CiDNNj30", learn:["Clean and analyze datasets","Build and evaluate ML models","Use NumPy, pandas, and scikit-learn"] },
  { id:6, title:"Business Strategy & Entrepreneurship", instructor:"Chris Williamson", category:"business", level:"intermediate", progress:38, image:"BS", rating:4.5, students:320000, price:11.99, description:"Learn strategy, startup principles, and entrepreneurship.", modules:12, lessons:140, duration:20, youtubeId:"xN6X5cdRZ8Q", youtubeUrl:"https://www.youtube.com/watch?v=xN6X5cdRZ8Q", learn:["Validate business ideas","Understand basic unit economics","Create simple pitch decks"] },
  { id:7, title:"Digital Marketing Masterclass", instructor:"Neil Patel", category:"marketing", level:"intermediate", progress:72, image:"DM", rating:4.7, students:650000, price:13.99, description:"Complete digital marketing covering SEO, SEM, social, analytics.", modules:20, lessons:280, duration:32, youtubeId:"8OBfr46Y0cQ", youtubeUrl:"https://www.youtube.com/watch?v=8OBfr46Y0cQ", learn:["Plan digital campaigns","Use SEO best practices","Analyze basic marketing metrics"] },
  { id:8, title:"Node.js & Express Complete Course", instructor:"Brad Traversy", category:"programming", level:"intermediate", progress:58, image:"NE", rating:4.8, students:720000, price:14.99, description:"Build fast backends with Node.js, Express, MongoDB.", modules:28, lessons:380, duration:40, youtubeId:"Oe421EPjeBE", youtubeUrl:"https://www.youtube.com/watch?v=Oe421EPjeBE", learn:["Create REST APIs","Use Express routing and middleware","Connect Node apps to MongoDB"] },
  { id:9, title:"Advanced CSS & Responsive Design", instructor:"Kevin Powell", category:"design", level:"intermediate", progress:82, image:"CS", rating:4.8, students:580000, price:12.99, description:"Master flexbox, grid, animations, and responsive design.", modules:22, lessons:290, duration:28, youtubeId:"1Rs2ND1ryYc", youtubeUrl:"https://www.youtube.com/watch?v=1Rs2ND1ryYc", learn:["Use CSS Grid/Flexbox","Build responsive layouts","Create subtle animation effects"] },
  { id:10, title:"AWS Cloud Practitioner Certification", instructor:"Stephane Maarek", category:"programming", level:"advanced", progress:41, image:"AW", rating:4.7, students:420000, price:16.99, description:"Prepare for AWS certification with solid cloud fundamentals.", modules:32, lessons:420, duration:50, youtubeId:"3hLmDS179YE", youtubeUrl:"https://www.youtube.com/watch?v=3hLmDS179YE", learn:["Understand AWS core services","Design simple cloud architectures","Prepare for certification questions"] }
];

let currentUser = null;
let dashboardData = {
  courses: COURSES_DATA,
  userCertificates: [],
  resume: null,
  downloads: [
    { id:1, resource:"JavaScript Cheat Sheet.pdf", course:"The Complete JavaScript Course 2024", type:"PDF", date:"Jan 20, 2024", url:"https://www.w3schools.com/js/js_syntax.asp" },
    { id:2, resource:"React Components Slides.pptx", course:"React - The Complete Guide 2024", type:"Slides", date:"Jan 18, 2024", url:"https://www.w3schools.com/react/" },
    { id:3, resource:"Python Practice Notebook.ipynb", course:"The Ultimate Python Learning Path", type:"Notebook", date:"Jan 15, 2024", url:"https://www.w3schools.com/python/" }
  ],
  notifications: [
    { id:1, title:"New Course: Machine Learning Pro", message:"A new ML course has been added to your recommended list.", type:"courses", date:"Today", unread:true },
    { id:2, title:"Certificate Earned", message:"Congrats! You earned a certificate in Advanced CSS.", type:"achievements", date:"Yesterday", unread:true },
    { id:3, title:"Course Reminder", message:"You haven't continued React in 3 days. Keep your streak going!", type:"courses", date:"2 days ago", unread:true },
    { id:4, title:"New Message", message:"Your instructor replied to your question in Node.js course.", type:"messages", date:"3 days ago", unread:false },
    { id:5, title:"Weekly Summary", message:"You studied 12 hours last week. Amazing job!", type:"achievements", date:"4 days ago", unread:false }
  ],
  stats: {
    enrolled: 10,
    hoursLearned: 125,
    certificates: 6,
    rating: 4.7
  }
};

document.addEventListener('DOMContentLoaded', async () => {
  const user = JSON.parse(localStorage.getItem('user'));
  const token = localStorage.getItem('authToken');

  if (!user || !token) {
    window.location.href = 'login-enhanced.html';
    return;
  }

  currentUser = user;
  updateUserUI();
  initTheme();
  loadDashboardData();
  loadCoursesUI();
  loadCustomCertificates();
  loadResumeStatus();
  loadActivityUI();
  loadProgressUI();
  loadFAQ();
  loadNotificationsUILight();
  loadDownloadsUI();
  loadPreviewVideos();
  setupEvents();
});

function updateUserUI() {
  const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
  document.getElementById('userInitials').textContent = initials;
  document.getElementById('profileAvatarLarge').textContent = initials;
  document.getElementById('userName').textContent = currentUser.name;
  document.getElementById('greetingName').textContent = currentUser.name.split(' ')[0];
  document.getElementById('profileName').textContent = currentUser.name;
  document.getElementById('profileEmail').textContent = currentUser.email;
  document.getElementById('profileRole').textContent = currentUser.role || 'Student';
  document.getElementById('settingsEmail').value = currentUser.email;
}

function loadDashboardData() {
  document.getElementById('enrolledCount').textContent = dashboardData.stats.enrolled;
  document.getElementById('hoursLearned').textContent = dashboardData.stats.hoursLearned;
  document.getElementById('certCount').textContent = dashboardData.stats.certificates;
  document.getElementById('avgRating').textContent = dashboardData.stats.rating.toFixed(1);
  document.getElementById('profileCoursesCount').textContent = dashboardData.stats.enrolled;
  document.getElementById('profileHoursCount').textContent = dashboardData.stats.hoursLearned;
  document.getElementById('profileCertCount').textContent = dashboardData.stats.certificates;
}

function courseLevelColor(level) {
  if (level === 'beginner') return '#10b981';
  if (level === 'intermediate') return '#f59e0b';
  return '#ef4444';
}

function renderCourseCard(course) {
  const levelColor = courseLevelColor(course.level);
  const youtubeButton = course.youtubeUrl ? `<a href="${course.youtubeUrl}" target="_blank" class="btn btn-primary" style="flex:1; text-align:center; text-decoration:none;"><i class="fab fa-youtube"></i> Watch on YouTube</a>` : '';
  return `
    <div class="course-card">
      <div class="course-image">${course.image}</div>
      <div class="course-content">
        <div>
          <span class="course-level" style="background:${levelColor}22;color:${levelColor};">${course.level.toUpperCase()}</span>
          <span class="course-badge">${course.progress}% Complete</span>
        </div>
        <div class="course-title" style="cursor:pointer;" onclick="viewCourse(${course.id})">${course.title}</div>
        <div class="course-description">${course.description}</div>
        <div class="course-instructor"><i class="fas fa-user-circle"></i> ${course.instructor}</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width:${course.progress}%;"></div>
        </div>
        <div class="course-footer">
          <div class="course-rating"><i class="fas fa-star"></i> ${course.rating}</div>
          <div class="course-students"><i class="fas fa-users"></i> ${(course.students/1000000).toFixed(1)}M</div>
        </div>
        <div style="display:flex; gap:8px; margin-top:12px;">
          <button class="btn btn-secondary" style="flex:1;" onclick="viewCourse(${course.id})"><i class="fas fa-book"></i> View Course</button>
          ${youtubeButton}
        </div>
      </div>
    </div>
  `;
}

function loadCoursesUI() {
  document.getElementById('activeCourses').innerHTML = dashboardData.courses.slice(0,3).map(renderCourseCard).join('');
  document.getElementById('myCoursesGrid').innerHTML = dashboardData.courses.map(renderCourseCard).join('');
  document.getElementById('wishlistGrid').innerHTML = dashboardData.courses.slice(5,8).map(renderCourseCard).join('');
  document.getElementById('recommendedCourses').innerHTML = dashboardData.courses.slice(8,10).map(renderCourseCard).join('');
  document.getElementById('downloadRecommendedCourses').innerHTML = dashboardData.courses.slice(3,6).map(renderCourseCard).join('');
}


function loadCustomCertificates() {
  const stored = localStorage.getItem('userCertificates');
  dashboardData.userCertificates = stored ? JSON.parse(stored) : [];
  renderCustomCertificates();
}

function renderCustomCertificates() {
  const list = document.getElementById('userCertificatesList');
  if (!dashboardData.userCertificates.length) {
    list.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:20px;color:var(--neutral-500);">No uploaded certificates yet.</div>';
    return;
  }

  list.innerHTML = dashboardData.userCertificates.map(c => `
    <div class="course-card">
      <div class="course-image" style="background:linear-gradient(135deg,#3b82f6,#2563eb);">
        <i class="fas fa-award"></i>
      </div>
      <div class="course-content">
        <div class="course-title">${c.title}</div>
        <div class="course-instructor"><i class="fas fa-building"></i> ${c.issuer || 'Personal'}</div>
        <div style="font-size:13px;color:var(--neutral-600);margin-bottom:8px;"><i class="fas fa-calendar"></i> ${c.date || 'Date not set'}</div>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn btn-primary" style="flex:1;" onclick="viewCustomCertificate('${c.id}')"><i class="fas fa-eye"></i> View</button>
          <button class="btn btn-secondary" style="flex:1;" onclick="downloadCustomCertificate('${c.id}')"><i class="fas fa-download"></i> Download</button>
          <button class="btn btn-secondary" style="flex:1;" onclick="deleteCustomCertificate('${c.id}')"><i class="fas fa-trash"></i> Remove</button>
        </div>
      </div>
    </div>
  `).join('');
}

function uploadCustomCertificate() {
  const title = document.getElementById('customCertTitle').value.trim();
  const issuer = document.getElementById('customCertIssuer').value.trim();
  const date = document.getElementById('customCertDate').value;
  const fileInput = document.getElementById('customCertFile');
  const file = fileInput.files[0];

  if (!title || !file) {
    showAlert('Please provide a title and select a certificate file.', 'warning');
    return;
  }

  if (file.size > 5 * 1024 * 1024) {
    showAlert('Certificate file is too large. Max 5MB.', 'error');
    return;
  }

  const reader = new FileReader();
  reader.onload = () => {
    const newCert = {
      id: Date.now().toString(),
      title,
      issuer,
      date,
      fileName: file.name,
      fileType: file.type,
      dataUrl: reader.result
    };

    dashboardData.userCertificates.unshift(newCert);
    localStorage.setItem('userCertificates', JSON.stringify(dashboardData.userCertificates));
    renderCustomCertificates();
    fileInput.value = '';
    document.getElementById('customCertTitle').value = '';
    document.getElementById('customCertIssuer').value = '';
    document.getElementById('customCertDate').value = '';
    showAlert('Certificate uploaded successfully.', 'success');
  };
  reader.readAsDataURL(file);
}

function viewCustomCertificate(id) {
  const cert = dashboardData.userCertificates.find(c => c.id === id);
  if (!cert) {
    showAlert('Certificate not found.', 'error');
    return;
  }
  window.open(cert.dataUrl, '_blank');
}

function downloadCustomCertificate(id) {
  const cert = dashboardData.userCertificates.find(c => c.id === id);
  if (!cert) {
    showAlert('Certificate not found.', 'error');
    return;
  }
  const link = document.createElement('a');
  link.href = cert.dataUrl;
  link.download = cert.fileName || 'certificate';
  link.click();
  showAlert('Certificate download started.', 'success');
}

function deleteCustomCertificate(id) {
  dashboardData.userCertificates = dashboardData.userCertificates.filter(c => c.id !== id);
  localStorage.setItem('userCertificates', JSON.stringify(dashboardData.userCertificates));
  renderCustomCertificates();
  showAlert('Certificate removed.', 'info');
}

function loadResumeStatus() {
  const stored = localStorage.getItem('userResume');
  dashboardData.resume = stored ? JSON.parse(stored) : null;
  updateResumeStatus();
}

function uploadResume() {
  const fileInput = document.getElementById('resumeFile');
  const file = fileInput.files[0];

  if (!file) {
    showAlert('Please choose a resume file.', 'warning');
    return;
  }

  if (file.size > 5 * 1024 * 1024) {
    showAlert('Resume file is too large. Max 5MB.', 'error');
    return;
  }

  const reader = new FileReader();
  reader.onload = () => {
    dashboardData.resume = {
      fileName: file.name,
      fileType: file.type,
      dataUrl: reader.result
    };
    localStorage.setItem('userResume', JSON.stringify(dashboardData.resume));
    fileInput.value = '';
    updateResumeStatus();
    showAlert('Resume uploaded successfully.', 'success');
  };
  reader.readAsDataURL(file);
}

function updateResumeStatus() {
  const status = document.getElementById('resumeStatus');
  if (!status) return;
  if (dashboardData.resume) {
    status.textContent = `Uploaded: ${dashboardData.resume.fileName}`;
  } else {
    status.textContent = 'No resume uploaded yet.';
  }
}

function viewResume() {
  if (!dashboardData.resume) {
    showAlert('No resume uploaded yet.', 'warning');
    return;
  }
  window.open(dashboardData.resume.dataUrl, '_blank');
}

function downloadResume() {
  if (!dashboardData.resume) {
    showAlert('No resume uploaded yet.', 'warning');
    return;
  }
  const link = document.createElement('a');
  link.href = dashboardData.resume.dataUrl;
  link.download = dashboardData.resume.fileName || 'resume';
  link.click();
  showAlert('Resume download started.', 'success');
}

function loadActivityUI() {
  const activities = [
    { course:"The Complete JavaScript Course 2024", activity:"Completed Module 15", date:"Today", status:"completed" },
    { course:"React - The Complete Guide 2024", activity:"Started Module 12", date:"Yesterday", status:"in-progress" },
    { course:"Node.js & Express Complete Course", activity:"Watched 3 videos", date:"2 days ago", status:"in-progress" },
    { course:"Advanced CSS & Responsive Design", activity:"Completed Quiz 5", date:"3 days ago", status:"completed" },
    { course:"The Ultimate Python Learning Path", activity:"Started Assignment 4", date:"4 days ago", status:"in-progress" }
  ];
  const tbody = document.getElementById('activityTable');
  tbody.innerHTML = activities.map(a => `
    <tr>
      <td><strong>${a.course}</strong></td>
      <td>${a.activity}</td>
      <td>${a.date}</td>
      <td>
        <span style="display:inline-block;padding:4px 10px;border-radius:999px;font-size:11px;font-weight:600;
          background:${a.status==='completed' ? '#ecfdf5' : '#eff6ff'};
          color:${a.status==='completed' ? '#065f46' : '#0c4a6e'};">
          ${a.status==='completed' ? 'Completed' : 'In Progress'}
        </span>
      </td>
    </tr>
  `).join('');
}

function loadProgressUI() {
  const weeklyData = [
    { day:'Mon', hours:2 },
    { day:'Tue', hours:3 },
    { day:'Wed', hours:1.5 },
    { day:'Thu', hours:4 },
    { day:'Fri', hours:2.5 },
    { day:'Sat', hours:3 },
    { day:'Sun', hours:1 }
  ];
  const maxH = 4;
  const weekly = document.getElementById('weeklyProgress');
  weekly.innerHTML = '<div style="display:flex;align-items:flex-end;gap:8px;height:160px;">' +
    weeklyData.map(d => `
      <div style="flex:1;display:flex;flex-direction:column;align-items:center;">
        <div style="width:100%;height:${(d.hours/maxH)*100}%;background:var(--primary-color);border-radius:4px 4px 0 0;"></div>
        <div style="font-size:12px;margin-top:6px;color:var(--neutral-600);">${d.day}</div>
      </div>
    `).join('') + '</div>';

  const completion = document.getElementById('courseCompletion');
  completion.innerHTML = dashboardData.courses.slice(0,5).map(c => `
    <div style="margin-bottom:8px;">
      <div style="display:flex;justify-content:space-between;font-size:13px;">
        <span style="color:var(--neutral-700);">${c.title}</span>
        <span style="color:var(--primary-color);font-weight:600;">${c.progress}%</span>
      </div>
      <div class="progress-bar"><div class="progress-fill" style="width:${c.progress}%"></div></div>
    </div>
  `).join('');

  const details = document.getElementById('progressDetails');
  details.innerHTML = dashboardData.courses.map(c => `
    <div style="background:var(--neutral-50);border-radius:8px;padding:10px;margin-bottom:8px;">
      <div style="display:flex;justify-content:space-between;font-size:13px;margin-bottom:4px;">
        <span style="font-weight:600;color:var(--neutral-800);">${c.title}</span>
        <span style="font-weight:600;color:var(--primary-color);">${c.progress}%</span>
      </div>
      <div class="progress-bar"><div class="progress-fill" style="width:${c.progress}%"></div></div>
      <div style="display:flex;gap:12px;font-size:11px;color:var(--neutral-500);margin-top:4px;">
        <span><i class="fas fa-book"></i> ${c.lessons} lessons</span>
        <span><i class="fas fa-clock"></i> ${c.duration}h</span>
        <span><i class="fas fa-star"></i> ${c.rating}</span>
      </div>
    </div>
  `).join('');
}

function loadFAQ() {
  const items = [
    { q:"How do I download course materials?", a:"Go to the Downloads section. All resources from enrolled courses are available there." },
    { q:"How do I reset my password?", a:"Open Settings â†’ Change Password and follow the steps." },
    { q:"How long are certificates valid?", a:"Certificates are valid for life and never expire." },
    { q:"Can I get a refund?", a:"Yes, within 30 days of purchase. Contact support for help." },
    { q:"Can I learn at my own pace?", a:"Yes, all courses are self-paced. You can pause and resume anytime." },
    { q:"Are there prerequisites?", a:"Beginner courses have none; check each course description for details." },
    { q:"Do you offer student discounts?", a:"Yes. Verify your student status in Settings to unlock discounts." },
    { q:"Can I access courses on mobile?", a:"Yes, the platform is fully responsive and mobile-friendly." }
  ];
  const c = document.getElementById('faqContainer');
  c.innerHTML = items.map((it,i) => `
    <div style="background:var(--neutral-50);border-radius:8px;padding:10px;cursor:pointer;" onclick="toggleFAQ(${i})">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div style="font-size:14px;font-weight:600;color:var(--neutral-800);">${it.q}</div>
        <i class="fas fa-chevron-down" id="faq-icon-${i}" style="font-size:12px;color:var(--neutral-500);"></i>
      </div>
      <div id="faq-answer-${i}" style="display:none;font-size:13px;color:var(--neutral-600);margin-top:6px;">${it.a}</div>
    </div>
  `).join('');
}

function loadNotificationsUILight() {
  document.getElementById('notificationBadge').textContent =
    dashboardData.notifications.filter(n => n.unread).length;
  filterNotifications('all');
}

function loadDownloadsUI() {
  const tbody = document.getElementById('downloadsTable');
  tbody.innerHTML = dashboardData.downloads.map(r => `
    <tr>
      <td>${r.resource}</td>
      <td>${r.course}</td>
      <td>${r.type}</td>
      <td>${r.date}</td>
      <td>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn btn-secondary" onclick="viewResource(${r.id})"><i class="fas fa-eye"></i> View</button>
          <button class="btn btn-primary" onclick="downloadResource(${r.id})"><i class="fas fa-download"></i> Download</button>
        </div>
      </td>
    </tr>
  `).join('');
}

/* PREVIEW VIDEOS ON DASHBOARD */

function loadPreviewVideos() {
  const container = document.getElementById('previewVideosGrid');
  const top = dashboardData.courses.slice(0,3);
  container.innerHTML = top.map(c => `
    <div style="background:var(--card-bg);border-radius:12px;padding:12px;box-shadow:var(--shadow-md);">
      <h3 style="font-size:15px;color:var(--text-heading);margin-bottom:6px;">${c.title}</h3>
      <div class="video-wrapper">
        ${renderVideoEmbed(c)}
      </div>
      <div class="video-meta">
        Instructor: ${c.instructor} â€¢
        <a href="${c.youtubeUrl}" target="_blank">Open on YouTube</a>
      </div>
    </div>
  `).join('');
}

/* NAV / FILTERS / SEARCH */

function navigateTo(page) {
  document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
  const el = document.getElementById(page + '-page');
  if (el) el.classList.add('active');

  document.querySelectorAll('.sidebar-menu a').forEach(a => a.classList.remove('active'));
  const active = document.querySelector('.sidebar-menu a[data-page="' + page + '"]');
  if (active) active.classList.add('active');

  window.location.hash = page;
  window.scrollTo(0,0);
}

function toggleUserMenu(e) {
  e.stopPropagation();
  const menu = document.getElementById('userProfileMenu');
  menu.classList.toggle('active');
  document.addEventListener('click', evt => {
    if (!evt.target.closest('.user-menu')) menu.classList.remove('active');
  }, { once:true });
}

function toggleNotifications() {
  navigateTo('notifications');
}

function toggleFilters() {
  const box = document.getElementById('filterSection');
  box.style.display = box.style.display === 'none' || !box.style.display ? 'block' : 'none';
}

function applyFilters() {
  const category = document.getElementById('categoryFilter').value;
  const level = document.getElementById('levelFilter').value;
  const prog = document.getElementById('progressFilter').value;
  let filtered = [...dashboardData.courses];

  if (category) filtered = filtered.filter(c => c.category === category);
  if (level) filtered = filtered.filter(c => c.level === level);
  if (prog) {
    const [min,max] = prog.split('-').map(Number);
    filtered = filtered.filter(c => c.progress >= min && c.progress <= max);
  }

  document.getElementById('myCoursesGrid').innerHTML = filtered.length
    ? filtered.map(renderCourseCard).join('')
    : '<div style="grid-column:1/-1;text-align:center;padding:24px;color:var(--neutral-500);">No matching courses</div>';
}

function searchCourses() {
  const q = document.getElementById('searchInput').value.toLowerCase().trim();
  if (!q) {
    loadCoursesUI();
    return;
  }
  const filtered = dashboardData.courses.filter(c =>
    c.title.toLowerCase().includes(q) ||
    c.description.toLowerCase().includes(q) ||
    c.instructor.toLowerCase().includes(q)
  );
  document.getElementById('myCoursesGrid').innerHTML = filtered.length
    ? filtered.map(renderCourseCard).join('')
    : '<div style="grid-column:1/-1;text-align:center;padding:24px;color:var(--neutral-500);">No courses found</div>';
}

/* COURSE MODAL / VIDEO */

function viewCourse(id) {
  const c = dashboardData.courses.find(x => x.id === id);
  if (!c) {
    showAlert('Course not found','error');
    return;
  }
  const backdrop = document.getElementById('courseModalBackdrop');
  const titleEl = document.getElementById('modalCourseTitle');
  const descEl = document.getElementById('modalCourseDescription');
  const metaEl = document.getElementById('modalMeta');
  const learnEl = document.getElementById('modalLearnList');
  const wrapper = document.getElementById('modalVideoWrapper');
  const link = document.getElementById('modalYoutubeLink');

  titleEl.textContent = c.title;
  descEl.textContent = c.description;
  link.href = c.youtubeUrl;

  wrapper.innerHTML = renderVideoEmbed(c);

  metaEl.innerHTML = `
    <span><i class="fas fa-signal"></i> Level: ${c.level}</span>
    <span><i class="fas fa-clock"></i> ${c.duration} hours</span>
    <span><i class="fas fa-list"></i> ${c.lessons} lessons</span>
    <span><i class="fas fa-star"></i> ${c.rating} rating</span>
    <span><i class="fas fa-user"></i> ${c.instructor}</span>
  `;

  learnEl.innerHTML = (c.learn || []).map(item => `<li>${item}</li>`).join('');

  backdrop.classList.add('active');
}

function getYoutubeEmbedUrl(videoId) {
  return `https://www.youtube-nocookie.com/embed/${videoId}?rel=0`;
}

function renderVideoEmbed(course) {
  if (!course.youtubeId) {
    return `<div style="color:#fff;display:flex;align-items:center;justify-content:center;height:100%;font-size:13px;">Preview video unavailable</div>`;
  }

  const src = getYoutubeEmbedUrl(course.youtubeId);
  return `
    <iframe
      src="${src}"
      title="${course.title} preview"
      loading="lazy"
      referrerpolicy="strict-origin-when-cross-origin"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      allowfullscreen></iframe>
  `;
}

function closeCourseModal() {
  const backdrop = document.getElementById('courseModalBackdrop');
  const wrapper = document.getElementById('modalVideoWrapper');
  wrapper.innerHTML = '';
  backdrop.classList.remove('active');
}

/* CERTIFICATES / FAQ / NOTIFICATIONS / CONTACT / AUTH */


function viewResource(id) {
  const item = dashboardData.downloads.find(r => r.id === id);
  if (!item) {
    showAlert('Resource not found.', 'error');
    return;
  }
  if (!item.url) {
    showAlert('No file available for viewing yet.', 'warning');
    return;
  }
  window.open(item.url, '_blank');
}

function downloadResource(id) {
  const item = dashboardData.downloads.find(r => r.id === id);
  if (!item) {
    showAlert('Resource not found.', 'error');
    return;
  }
  if (!item.url) {
    showAlert('No file available for download yet.', 'warning');
    return;
  }
  const link = document.createElement('a');
  link.href = item.url;
  link.download = item.resource || 'download';
  link.click();
  showAlert('Download started.', 'success');
}

function toggleFAQ(i) {
  const ans = document.getElementById('faq-answer-' + i);
  const icon = document.getElementById('faq-icon-' + i);
  const open = ans.style.display === 'block';
  ans.style.display = open ? 'none' : 'block';
  icon.style.transform = open ? 'rotate(0deg)' : 'rotate(180deg)';
}

function filterNotifications(type) {
  document.querySelectorAll('[id^="filter"]').forEach(b => b.classList.remove('active'));
  document.getElementById('filter' + type.charAt(0).toUpperCase() + type.slice(1)).classList.add('active');
  const list = type === 'all'
    ? dashboardData.notifications
    : dashboardData.notifications.filter(n => n.type === type);
  const c = document.getElementById('notificationsContainer');
  c.innerHTML = list.map(n => `
    <div style="background:var(--card-bg);border-radius:12px;padding:12px;margin-bottom:8px;box-shadow:var(--shadow-md);border-left:4px solid var(--primary-color);">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;">
        <div>
          <div style="font-weight:600;color:var(--neutral-800);margin-bottom:4px;">${n.title}</div>
          <div style="font-size:13px;color:var(--neutral-600);margin-bottom:4px;">${n.message}</div>
          <div style="font-size:11px;color:var(--neutral-500);">${n.date}</div>
        </div>
        <button onclick="deleteNotification(${n.id})" style="background:none;border:none;color:var(--neutral-400);cursor:pointer;"><i class="fas fa-times"></i></button>
      </div>
    </div>
  `).join('');
}

function markAllAsRead() {
  dashboardData.notifications.forEach(n => n.unread = false);
  document.getElementById('notificationBadge').textContent = '0';
  showAlert('All notifications marked as read', 'success');
}

function deleteNotification(id) {
  dashboardData.notifications = dashboardData.notifications.filter(n => n.id !== id);
  filterNotifications('all');
  showAlert('Notification deleted', 'info');
}

function submitContact(e) {
  e.preventDefault();
  showAlert('Message sent successfully! Our team will respond soon.', 'success');
  e.target.reset();
}

function deleteAccount() {
  if (confirm('Are you sure you want to delete your account? This cannot be undone.')) {
    showAlert('Account deletion request submitted.', 'warning');
  }
}

function logoutUser() {
  localStorage.removeItem('authToken');
  localStorage.removeItem('user');
  localStorage.removeItem('userId');
  window.location.href = 'login-enhanced.html';
}

/* THEME HANDLING */

function changeTheme(mode) {
  const r = document.documentElement.style;
  
  // Add smooth transition
  document.documentElement.style.transition = 'background-color 0.3s ease, color 0.3s ease';
  
  if (mode === 'dark') {
    r.setProperty('--body-bg', '#1a1a2e');
    r.setProperty('--card-bg', '#16213e');
    r.setProperty('--text-main', '#e0e0e0');
    r.setProperty('--text-heading', '#f0f9ff');
    r.setProperty('--text-accent', '#60a5fa');
    r.setProperty('--neutral-100', '#2a2a3e');
    r.setProperty('--neutral-200', '#3a3a4e');
  } else if (mode === 'high-contrast') {
    r.setProperty('--body-bg', '#000000');
    r.setProperty('--card-bg', '#1a1a1a');
    r.setProperty('--text-main', '#ffffff');
    r.setProperty('--text-heading', '#ffff00');
    r.setProperty('--text-accent', '#00ff00');
    r.setProperty('--neutral-100', '#333333');
    r.setProperty('--neutral-200', '#4d4d4d');
  } else {
    // Light mode
    r.setProperty('--body-bg', '#f9fafb');
    r.setProperty('--card-bg', '#ffffff');
    r.setProperty('--text-main', '#1e293b');
    r.setProperty('--text-heading', '#0f172a');
    r.setProperty('--text-accent', '#6366f1');
    r.setProperty('--neutral-100', '#f3f4f6');
    r.setProperty('--neutral-200', '#e5e7eb');
  }
  
  // Save to localStorage
  localStorage.setItem('vrlearn-theme', mode);
  
  // Update dropdown
  const select = document.getElementById('themeSelect');
  if (select && select.value !== mode) {
    select.value = mode;
  }
  
  // Update active button states in themes page
  const buttons = document.querySelectorAll('[onclick*="changeTheme"]');
  buttons.forEach(btn => {
    btn.classList.remove('btn-primary');
    btn.classList.add('btn-secondary');
  });
  
  const activeBtn = document.querySelector(`button[onclick="changeTheme('${mode}')"]`);
  if (activeBtn) {
    activeBtn.classList.remove('btn-secondary');
    activeBtn.classList.add('btn-primary');
  }
}

function initTheme() {
  const saved = localStorage.getItem('vrlearn-theme') || 'light';
  changeTheme(saved);
}

/* ALERTS / EVENTS */

function showAlert(msg, type='info') {
  const icons = {
    success: 'fa-check-circle',
    error: 'fa-exclamation-circle',
    info: 'fa-info-circle',
    warning: 'fa-exclamation-triangle'
  };
  const div = document.createElement('div');
  div.className = 'alert alert-' + type;
  div.innerHTML = `<i class="fas ${icons[type]}"></i><span>${msg}</span><button class="alert-close" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>`;
  const cont = document.querySelector('.container');
  cont.insertBefore(div, cont.firstChild);
  setTimeout(() => { if (div.parentElement) div.remove(); }, 5000);
}

function setupEvents() {
  const si = document.getElementById('searchInput');
  if (si) {
    si.addEventListener('keypress', e => {
      if (e.key === 'Enter') searchCourses();
    });
  }

  const hash = window.location.hash.replace('#','');
  if (hash) navigateTo(hash);
}
</script>

</body>
</html>
